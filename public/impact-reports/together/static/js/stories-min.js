var StoryReady=$.Deferred();window.StoryReady=StoryReady,$.when().then(function(){var e=$(window),t=($("body"),$(".js-story-slider"));t.on("init",function(){r()}),t.slick({infinite:!1,adaptiveHeight:!0}),t.find(".slick-active").focus();var n=$(".js-story-progress"),o=$(".js-story-progress__label");if(t.on("beforeChange",function(e,t,a,s){var i=s/(t.slideCount-1)*100;n.css("transform","translateX( "+i+"%").attr("aria-valuenow",i),o.text(i+"% completed")}),window.location.hash){var a=window.location.hash;t.slick("slickGoTo",a.substring(1))}t.on("afterChange",function(t,n,o,a){if(1==o){var d=document.getElementById("mc-tracking");d.src=d.getAttribute("data-src")}r(),function(e){var t=i.find(function(t){var n=t.slideIndex;return n===e});t.stopAmbient&&l();t.soundInstance&&!t.isPlaying&&(l(),t.soundInstance.volume(1),t.soundInstance.play(),t.isPlaying=!0)}(o),"undefined"!=typeof soundcite&&soundcite.pause_all_clips(),s&&($(".js-story-video-added").children(".js-story-video").remove(),s=!1),function(){if("undefined"!=typeof iosPlayer){iosPlayer.pause();var e=document.getElementById("play-button");e.style.display="block"}}(),function(){var e=$(".slick-active .js-story-video-template");if(e.length){var t=e.parent(".js-story-video-container"),n=e.children().clone();n.attr("src",(e,t)=>t.replace("autoplay=0","autoplay=1")),t.append(n),t.addClass("js-story-video-added"),s=!0}}(),e.scrollTop()>0&&$("html, body").animate({scrollTop:0},10)});var s=!1;$(".js-story-audio-mute").on("click",function(){var e=$(this),t=document.getElementById("volume-up"),n=document.getElementById("volume-off"),o=document.getElementById("On_off");e.hasClass("js-mute")?(Howler.mute(!1),t.className.baseVal="",n.style.fill="#000",o.style.fill="#000"):(Howler.mute(!0),t.className.baseVal="howler-muted",n.style.fill="#606060",o.style.fill="#606060"),e.toggleClass("js-mute")});var i=[];function l(){var e=i.find(function(e){return!0===e.isPlaying});e&&(e.soundInstance.on("fade",function(){e.soundInstance.stop()}),e.soundInstance.fade(1,0,1e3),e.isPlaying=!1)}function r(){$(".slick-active .js-img-prog-container").each(function(){var e=$(this),t=e.find(".js-img-prog-low"),n=new Image;n.src=t.attr("src"),n.onload=function(){t.addClass("js-img-prog-loaded")};var o=new Image;o.src=t.data("large"),o.alt=t.attr("alt"),o.onload=function(){o.className="js-img-prog-high js-img-prog-loaded"},o.style="position:absolute",e.append(o),e.removeClass("js-img-prog-container")})}$(".js-section-story__audio").each(function(){var e=$(this),t=e.data("slick-index"),n=e.data("ambienturl"),o="";n&&(o=new Howl({src:[n],autoplay:!1,loop:!0,volume:1})),i.push({slideIndex:t,soundInstance:o,stopAmbient:e.data("ambientstop"),isPlaying:!1})}),$(".soundcite").each(function(){var e=$(this),t=new MutationObserver(function(n){n.forEach(function(n){if("class"===n.attributeName){var o=e.prop(n.attributeName);-1!==o.indexOf("soundcite-play")?(Howler.volume(1),t.disconnect()):-1!==o.indexOf("soundcite-pause")&&Howler.volume(.1)}})});e.on("click",function(){e.hasClass("soundcite-play")&&t.observe(e[0],{attributes:!0})})})});